<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>업그레이드 D-Day</title>
    <style>
        /* CSS: 앱 디자인 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* 상단 정렬 */
            min-height: 100vh;
            margin: 0;
            padding-top: 40px;
        }

        .container {
            background-color: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
            width: 90%;
            max-width: 500px;
            text-align: center;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .input-box {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .input-box input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        .input-box button {
            padding: 12px;
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .input-box button:hover {
            transform: scale(1.02);
        }
        
        .sort-box {
            margin-bottom: 20px;
        }
        
        #sort-button {
            padding: 8px 16px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        #sort-button:hover {
            background-color: #5a6268;
        }

        #dday-list {
            list-style: none;
            padding: 0;
            text-align: left;
        }

        .dday-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .dday-info {
            flex-grow: 1;
        }

        .dday-title {
            font-weight: bold;
            font-size: 1.1em;
            color: #343a40;
        }
        
        .dday-date {
            font-size: 0.8em;
            color: #6c757d;
        }

        .dday-countdown {
            font-size: 0.9em;
            color: #495057;
        }

        .dday-result {
            font-size: 1.2em;
            font-weight: bold;
            color: #dc3545;
            margin-top: 5px;
            display: block;
        }
        
        .delete-button {
            background-color: transparent;
            color: #dc3545;
            border: none;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            padding: 5px 10px;
        }
        .delete-button:hover {
            opacity: 0.7;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>D-Day 카운터</h1>
        <div class="input-box">
            <input type="text" id="event-title" placeholder="이벤트 이름을 입력하세요">
            <input type="date" id="event-date">
            <button id="add-button">추가하기</button>
        </div>
        
        <div class="sort-box">
            <button id="sort-button">마감일 임박 순으로 정렬</button>
        </div>

        <ul id="dday-list">
            <!-- D-Day 목록이 여기에 동적으로 추가됩니다 -->
        </ul>
    </div>

    <script>
        // JavaScript: 앱의 모든 기능 구현

        // 1. DOM 요소 가져오기
        const titleInput = document.getElementById('event-title');
        const dateInput = document.getElementById('event-date');
        const addButton = document.getElementById('add-button');
        const sortButton = document.getElementById('sort-button');
        const ddayList = document.getElementById('dday-list');

        // 2. D-Day 데이터를 저장할 배열
        // 로컬 스토리지에서 데이터를 불러오거나, 없으면 빈 배열로 시작
        let ddays = JSON.parse(localStorage.getItem('ddays')) || [];

        // 3. 핵심 함수들
        
        /**
         * 현재 D-Day 배열을 로컬 스토리지에 저장하는 함수
         */
        const saveDdays = () => {
            localStorage.setItem('ddays', JSON.stringify(ddays));
        };

        /**
         * D-Day 목록을 화면에 렌더링하는 함수
         */
        const renderDdays = () => {
            // 목록을 비우고 다시 그림
            ddayList.innerHTML = '';

            // ddays 배열의 각 항목에 대해 li 요소 생성
            ddays.forEach(dday => {
                const li = document.createElement('li');
                li.classList.add('dday-item');

                // 남은 시간 계산
                const targetDate = new Date(dday.date);
                const now = new Date();
                const diff = targetDate - now; // 밀리초 단위 차이

                const diffDays = Math.floor(diff / (1000 * 60 * 60 * 24));
                const diffHours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const diffMinutes = Math.floor((diff / (1000 * 60)) % 60);
                const diffSeconds = Math.floor((diff / 1000) % 60);

                let resultText = '';
                let countdownText = '';

                if (diff < 0) {
                    // D-Day가 지난 경우
                    resultText = `D+${Math.abs(diffDays) + 1}`;
                    countdownText = '종료된 이벤트입니다.';
                } else {
                    // D-Day가 남은 경우
                    resultText = `D-${diffDays}`;
                    countdownText = `${String(diffHours).padStart(2, '0')}시간 ${String(diffMinutes).padStart(2, '0')}분 ${String(diffSeconds).padStart(2, '0')}초 남음`;
                }
                
                if (diffDays === 0 && diff > 0) {
                    resultText = 'D-Day!';
                }


                li.innerHTML = `
                    <div class="dday-info">
                        <div class="dday-title">${dday.title}</div>
                        <div class="dday-date">${dday.date}</div>
                        <div class="dday-countdown">${countdownText}</div>
                        <div class="dday-result">${resultText}</div>
                    </div>
                    <button class="delete-button" data-id="${dday.id}">×</button>
                `;

                ddayList.appendChild(li);
            });
        };
        
        /**
         * D-Day 항목을 추가하는 함수
         */
        const addDday = () => {
            const title = titleInput.value;
            const date = dateInput.value;

            if (!title || !date) {
                alert('이벤트 이름과 날짜를 모두 입력해주세요.');
                return;
            }

            // 새로운 D-Day 객체 생성
            const newDday = {
                id: Date.now(), // 고유 ID로 현재 시간을 사용
                title: title,
                date: date,
            };

            // 배열에 추가
            ddays.push(newDday);

            // 저장 및 화면 다시 그리기
            saveDdays();
            renderDdays();

            // 입력 필드 초기화
            titleInput.value = '';
            dateInput.value = '';
        };

        /**
         * D-Day 항목을 삭제하는 함수
         * @param {number} id - 삭제할 D-Day의 고유 ID
         */
        const deleteDday = (id) => {
            // filter를 사용해 해당 id를 가진 항목을 제외한 새 배열을 만듦
            ddays = ddays.filter(dday => dday.id !== id);
            
            // 저장 및 화면 다시 그리기
            saveDdays();
            renderDdays();
        };

        // 4. 이벤트 리스너 설정

        // '추가하기' 버튼 클릭 이벤트
        addButton.addEventListener('click', addDday);
        
        // 엔터 키로 추가하기
        titleInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                addDday();
            }
        });

        // '삭제' 버튼 클릭 이벤트 (이벤트 위임 사용)
        ddayList.addEventListener('click', (e) => {
            // 클릭된 요소가 삭제 버튼인지 확인
            if (e.target.classList.contains('delete-button')) {
                // data-id 속성에서 id 값을 가져옴 (숫자로 변환)
                const idToDelete = Number(e.target.dataset.id);
                deleteDday(idToDelete);
            }
        });
        
        // '정렬' 버튼 클릭 이벤트
        sortButton.addEventListener('click', () => {
            ddays.sort((a, b) => new Date(a.date) - new Date(b.date));
            renderDdays();
        });


        // 5. 앱 초기화
        
        // 1초마다 화면을 다시 그려서 실시간 카운트다운 효과를 줌
        setInterval(renderDdays, 1000);

        // 페이지가 처음 로드될 때 저장된 D-Day 목록을 화면에 표시
        renderDdays();

    </script>
</body>
</html>
