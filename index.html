<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D-Day 앱 (보기/편집 모드)</title>
    <style>
        /* CSS: 앱 디자인 */
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap');

        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
            margin: 0;
            padding: 40px 15px;
            box-sizing: border-box;
        }

        .container {
            background-color: white;
            padding: 20px 30px;
            border-radius: 12px;
            box-shadow: 0 6px T20px rgba(0, 0, 0, 0.08);
            width: 100%;
            max-width: 500px;
            text-align: center;
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 20px;
        }

        /* 편집/완료 버튼 */
        .edit-controls {
            margin-bottom: 20px;
        }

        #toggle-edit-button {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 8px;
            border: 1px solid #007bff;
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s, color 0.2s;
        }
        
        /* 편집 모드일 때 버튼 스타일 변경 */
        .container.edit-mode #toggle-edit-button {
            background-color: #f8f9fa;
            color: #007bff;
        }

        /* 편집 패널 (입력, 정렬) */
        #edit-panel {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        #edit-panel input {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }

        #add-button {
            padding: 12px;
            background: linear-gradient(45deg, #28a745, #218838);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: transform 0.2s;
        }
        #add-button:hover {
            transform: scale(1.02);
        }
        
        #sort-button {
            padding: 8px 16px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        /* D-Day 목록 */
        #dday-list {
            list-style: none;
            padding: 0;
            text-align: left;
        }

        .dday-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .dday-info { flex-grow: 1; }
        .dday-title { font-weight: bold; font-size: 1.1em; color: #343a40; }
        .dday-date { font-size: 0.8em; color: #6c757d; }
        .dday-countdown { font-size: 0.9em; color: #495057; }
        .dday-result { font-size: 1.2em; font-weight: bold; color: #dc3545; margin-top: 5px; display: block; }

        /* D+ 상세 정보 스타일 */
        .dday-elapsed {
            font-size: 0.85em;
            color: #17a2b8;
            margin-top: 4px;
        }
        
        .delete-button {
            background-color: transparent;
            color: #dc3545;
            border: none;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            padding: 5px 10px;
        }

        /* 유틸리티 클래스 */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>

    <div class="container" id="app-container">
        <h1>D-Day 카운터</h1>

        <div class="edit-controls">
            <button id="toggle-edit-button">편집</button>
        </div>

        <!-- 편집 모드에서만 보이는 패널 -->
        <div id="edit-panel" class="hidden">
            <input type="text" id="event-title" placeholder="이벤트 이름을 입력하세요">
            <input type="date" id="event-date">
            <button id="add-button">추가하기</button>
            <button id="sort-button">마감일 임박 순으로 정렬</button>
        </div>
        
        <ul id="dday-list">
            <!-- D-Day 목록이 여기에 동적으로 추가됩니다 -->
        </ul>
    </div>

    <script>
        // === DOM 요소 가져오기 ===
        const container = document.getElementById('app-container');
        const toggleEditButton = document.getElementById('toggle-edit-button');
        const editPanel = document.getElementById('edit-panel');
        const titleInput = document.getElementById('event-title');
        const dateInput = document.getElementById('event-date');
        const addButton = document.getElementById('add-button');
        const sortButton = document.getElementById('sort-button');
        const ddayList = document.getElementById('dday-list');

        // === 상태 관리 ===
        let ddays = JSON.parse(localStorage.getItem('ddays')) || [];
        let isEditMode = false; // 현재 모드 (false: 보기, true: 편집)
        let countdownInterval;

        // === 핵심 함수 ===

        const saveDdays = () => {
            localStorage.setItem('ddays', JSON.stringify(ddays));
        };

        const renderDdays = () => {
            ddayList.innerHTML = '';

            ddays.forEach(dday => {
                const li = document.createElement('li');
                li.classList.add('dday-item');

                const targetDate = new Date(dday.date);
                const now = new Date();
                const diff = targetDate - now;

                const diffDays = Math.floor(diff / (1000 * 60 * 60 * 24));
                const diffHours = Math.floor((diff / (1000 * 60 * 60)) % 24);
                const diffMinutes = Math.floor((diff / (1000 * 60)) % 60);
                const diffSeconds = Math.floor((diff / 1000) % 60);

                let resultText = '';
                let countdownHTML = '';

                if (diff < 0) {
                    // D-Day가 지난 경우
                    const totalDaysPassed = Math.abs(diffDays);
                    resultText = `D+${totalDaysPassed}`;

                    // 년/월/일 계산
                    let years = now.getFullYear() - targetDate.getFullYear();
                    let months = now.getMonth() - targetDate.getMonth();
                    let days = now.getDate() - targetDate.getDate();

                    if (days < 0) {
                        months--;
                        days += new Date(now.getFullYear(), now.getMonth(), 0).getDate();
                    }
                    if (months < 0) {
                        years--;
                        months += 12;
                    }
                    
                    countdownHTML = `<div class="dday-elapsed">${years}년 ${months}개월 ${days}일 지남</div>`;

                } else {
                    // D-Day가 남은 경우
                    resultText = `D-${diffDays}`;
                    if (diffDays === 0) resultText = 'D-Day!';
                    countdownHTML = `<div class="dday-countdown">${String(diffHours).padStart(2, '0')}시간 ${String(diffMinutes).padStart(2, '0')}분 ${String(diffSeconds).padStart(2, '0')}초 남음</div>`;
                }
                
                // 편집 모드일 때만 삭제 버튼을 보여줌
                const deleteButtonHTML = isEditMode ? `<button class="delete-button" data-id="${dday.id}">×</button>` : '';

                li.innerHTML = `
                    <div class="dday-info">
                        <div class="dday-title">${dday.title}</div>
                        <div class="dday-date">${dday.date}</div>
                        ${countdownHTML}
                        <div class="dday-result">${resultText}</div>
                    </div>
                    ${deleteButtonHTML}
                `;
                ddayList.appendChild(li);
            });
        };

        const toggleEditMode = () => {
            isEditMode = !isEditMode; // 모드 전환
            
            // 클래스와 버튼 텍스트 변경으로 UI 업데이트
            container.classList.toggle('edit-mode', isEditMode);
            editPanel.classList.toggle('hidden', !isEditMode);
            toggleEditButton.textContent = isEditMode ? '완료' : '편집';

            // 모드가 바뀔 때마다 목록을 다시 그려서 삭제 버튼 등을 업데이트
            renderDdays();
        };
        
        const addDday = () => {
            if (!titleInput.value || !dateInput.value) {
                alert('이벤트 이름과 날짜를 모두 입력해주세요.');
                return;
            }
            const newDday = { id: Date.now(), title: titleInput.value, date: dateInput.value };
            ddays.push(newDday);
            saveDdays();
            renderDdays();
            titleInput.value = '';
            dateInput.value = '';
        };

        const deleteDday = (id) => {
            ddays = ddays.filter(dday => dday.id !== id);
            saveDdays();
            renderDdays();
        };
        
        const sortDdays = () => {
            ddays.sort((a, b) => new Date(a.date) - new Date(b.date));
            renderDdays();
        };

        // === 이벤트 리스너 설정 ===
        toggleEditButton.addEventListener('click', toggleEditMode);
        addButton.addEventListener('click', addDday);
        sortButton.addEventListener('click', sortDdays);
        
        ddayList.addEventListener('click', (e) => {
            if (e.target.classList.contains('delete-button')) {
                deleteDday(Number(e.target.dataset.id));
            }
        });

        // === 앱 초기화 ===
        countdownInterval = setInterval(renderDdays, 1000);
        renderDdays(); // 페이지 첫 로드 시 목록 표시

    </script>
</body>
</html>
